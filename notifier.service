[Unit]
Description=TPM2 Number
Requires=tpm2-abrmd.service
# These settings are needed when using the device TCTI. If the
# TCP mssim is used then the settings should be commented out.

[Service]
ExecStart=flock -x /data/tmp.lock -c "number=$(</data/tpm.num) && new_number=$((number + 1)) && echo $new_number > /data/tpm.num"
User=root

[Install]
WantedBy=multi-user.target